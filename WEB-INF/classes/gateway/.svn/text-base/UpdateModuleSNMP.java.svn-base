package gateway;

import org.snmp4j.CommunityTarget;
import org.snmp4j.PDU;
import org.snmp4j.Snmp;
import org.snmp4j.TransportMapping;
import org.snmp4j.event.ResponseEvent;
import org.snmp4j.mp.SnmpConstants;
import org.snmp4j.smi.Address;
import org.snmp4j.smi.GenericAddress;
import org.snmp4j.smi.Integer32;
import org.snmp4j.smi.OID;
import org.snmp4j.smi.OctetString;
import org.snmp4j.smi.UdpAddress;
import org.snmp4j.smi.UnsignedInteger32;
import org.snmp4j.smi.VariableBinding;
import org.snmp4j.transport.DefaultUdpTransportMapping;
import org.snmp4j.event.ResponseListener;
import org.snmp4j.smi.*;

public class UpdateModuleSNMP {

	private OctetString get_community;
	private Address targetaddress;
	private TransportMapping transport;
	private CommunityTarget comtarget;
	private PDU pdu;
	private ResponseEvent response;
	private Snmp snmp;

	public void snmpSetConf(String strAddress, String community) {

		try {

			get_community = new OctetString(community);
			strAddress = strAddress + "/" + "161";

			targetaddress = new UdpAddress(strAddress);
			transport = new DefaultUdpTransportMapping();
			transport.listen();

			comtarget = new CommunityTarget();
			comtarget.setCommunity(get_community);
			comtarget.setVersion(SnmpConstants.version1);
			comtarget.setAddress(targetaddress);
			comtarget.setRetries(2);
			comtarget.setTimeout(5000);

			pdu = new PDU();
			snmp = new Snmp(transport);
			System.out.println("Connection Success");

		} catch (Exception e) {
			e.printStackTrace();
		}

	}

	public void snmpCloseSession() {

		try {
			snmp.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public String snmpGet() {
		String str 				= "";
		try {
			
		} catch (Exception e) {
			e.printStackTrace();
		}
		return str;
	}

	public Snmp retSnmp() {
		return snmp;
	}
	
	public String getSNMP(String snmpIP) {
		UpdateModuleSNMP updateModuleSNMP = new UpdateModuleSNMP();

		updateModuleSNMP.snmpSetConf(snmpIP,"public");
		
		String Result= updateModuleSNMP.snmpGet();
		
		updateModuleSNMP.snmpCloseSession();
		
		return Result;
	}

	public void snmpSet(String strAddress, String community, String strOID, String Value, int type)
	{
		strAddress= strAddress+"/"+"161";
		Address targetAddress = GenericAddress.parse(strAddress);
		Snmp snmp;
		try
		{
			TransportMapping transport = new DefaultUdpTransportMapping();
			snmp = new Snmp(transport);
			transport.listen();
			CommunityTarget target = new CommunityTarget();
			target.setCommunity(new OctetString(community));
			target.setAddress(targetAddress);
			target.setRetries(2);
			target.setTimeout(5000);
			target.setVersion(SnmpConstants.version1);
			PDU pdu = new PDU();
			
			if(type==1){
				int temp = Integer.parseInt(Value);
				pdu.add(new VariableBinding(new OID(strOID), new Integer32(temp)));
			}else if(type==2){
				int temp = Integer.parseInt(Value);
				pdu.add(new VariableBinding(new OID(strOID), new UnsignedInteger32(temp)));
			}else if(type==3){
				pdu.add(new VariableBinding(new OID(strOID), new OctetString(Value)));
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.1.3.8.3.0"), new Integer32(1)));
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.1.5.0"), new UnsignedInteger32(1)));
			}else if(type==4){
				pdu.add(new VariableBinding(new OID(strOID), new OctetString(Value)));
				//pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.1.12.0"), new Gauge32(1222572)));
				//pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.1.12.0"), new Gauge32(8976125)));
				//pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.1.5.0"), new Gauge32(1)));
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.1.5.0"), new UnsignedInteger32(1)));

			}else if(type==5){
				pdu.add(new VariableBinding(new OID(strOID), new OctetString(Value)));
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.2.0"), new Integer32(1)));
				
				//pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.5.0"), new Gauge32(3404727)));
			}else if(type==6){
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.5.0"), new Gauge32(5153266)));
			}else if(type==7){
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.1.0"), new Integer32(1)));
			}
			
			pdu.setType(PDU.SET);

			ResponseListener listener = new ResponseListener() {
				public void onResponse(ResponseEvent event) {
					try{
						((Snmp)event.getSource()).cancel(event.getRequest(), this);
						System.out.println("Set Status is: "+event.getResponse().getErrorStatusText());
					}catch(Exception e){
						
					}
				}
			};
			snmp.send(pdu, target, null, listener);
			snmp.close();
		}
		catch (Exception e){
			e.printStackTrace();
		}
	}

	public void snmpSetIni(String strAddress, String community, String strOID, String Value, int type)
	{
		strAddress= strAddress+"/"+"161";
		Address targetAddress = GenericAddress.parse(strAddress);
		Snmp snmp;
		try
		{
			TransportMapping transport = new DefaultUdpTransportMapping();
			snmp = new Snmp(transport);
			transport.listen();
			CommunityTarget target = new CommunityTarget();
			target.setCommunity(new OctetString(community));
			target.setAddress(targetAddress);
			target.setRetries(2);
			target.setTimeout(5000);
			target.setVersion(SnmpConstants.version1);
			PDU pdu = new PDU();
			
			if(type==1){
				int temp = Integer.parseInt(Value);
				pdu.add(new VariableBinding(new OID(strOID), new Integer32(temp)));
			}else if(type==2){
				int temp = Integer.parseInt(Value);
				pdu.add(new VariableBinding(new OID(strOID), new UnsignedInteger32(temp)));
			}else if(type==3){
				pdu.add(new VariableBinding(new OID(strOID), new OctetString(Value)));
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.2.0"), new Integer32(1)));
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.5.0"), new Gauge32(3404727)));
//				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.5.0"), new Gauge32(5153266)));
//				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.1.0"), new Integer32(1)));
			}else if(type==4){
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.5.0"), new Gauge32(5153266)));
			}else if(type==5){
				pdu.add(new VariableBinding(new OID("1.3.6.1.4.1.5003.9.10.10.3.1.3.1.0"), new Integer32(1)));
			}
			
			pdu.setType(PDU.SET);

			ResponseListener listener = new ResponseListener() {
				public void onResponse(ResponseEvent event) {
					try{
						((Snmp)event.getSource()).cancel(event.getRequest(), this);
						System.out.println("Set Status is: "+event.getResponse().getErrorStatusText());
					}catch(Exception e){
						e.printStackTrace();
					}
				}
			};
			snmp.send(pdu, target, null, listener);
			snmp.close();
		}
		catch (Exception e){
			e.printStackTrace();
		}
	}

}

