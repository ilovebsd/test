package bizportal.nasacti.ipivr.action.admin;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import bizportal.nasacti.ipivr.action.CommandAction;
import bizportal.nasacti.ipivr.common.IpivrConfig;
import bizportal.nasacti.ipivr.dao.ModeSettingDAO;
import bizportal.nasacti.ipivr.dto.ModeSettingDTO;
import bizportal.nasacti.ipivr.dao.ResponseTimeDAO;
import bizportal.nasacti.ipivr.dto.ResponseTimeDTO;

public class VoiceGuideSettingInputAction implements CommandAction {
	/**
	 * requestProc
	 *
	 * @param request HttpServletRequest
	 * @param response HttpServletResponse
	 * @param ipivrConfig IpivrConfig
	 * @return String
	 * @throws Throwable
	 * @todo Implement this bizportal.nasacti.ipivr.action.CommandAction
	 *   method
	 */
	public String requestProc(HttpServletRequest request,
							  HttpServletResponse response,
							  IpivrConfig ipivrConfig) throws Throwable {
		int iRtn = -1;

		String strTrIdx = request.getParameter("trIdx");
		String strAmIndex = request.getParameter("amIndex");
		String strAdDateType = request.getParameter("adDateType");
		String strAmModeName = "";
		String strAdWeekMon = request.getParameter("adWeekMon") == null ? "N" : "Y";
		String strAdWeekTue = request.getParameter("adWeekTue") == null ? "N" : "Y";
		String strAdWeekWed = request.getParameter("adWeekWed") == null ? "N" : "Y";
		String strAdWeekThu = request.getParameter("adWeekThu") == null ? "N" : "Y";
		String strAdWeekFri = request.getParameter("adWeekFri") == null ? "N" : "Y";
		String strAdWeekSat = request.getParameter("adWeekSat") == null ? "N" : "Y";
 		String strAdWeekSun = request.getParameter("adWeekSun") == null ? "N" : "Y";
		String strStartMonth = request.getParameter("startMonth");
		String strStartDay = request.getParameter("startDay");
		String strEndMonth = request.getParameter("endMonth");
		String strEndDay = request.getParameter("endDay");
		String strAdSDateDay = "";
		String strAdEDateDay = "";

		if(strAdDateType.equals("W")) {
			strAdSDateDay = "";
			strAdEDateDay = "";
		} else {
            strAdSDateDay = strStartMonth + "/" + strStartDay;
			strAdEDateDay = strEndMonth + "/" + strEndDay;
		}

		ResponseTimeDAO responseTimeDAO = ResponseTimeDAO.getInstance();
		ResponseTimeDTO responseTimeDTO = responseTimeDAO.getResponseTime(strAmIndex);
		strAmModeName = responseTimeDTO.getAmModeName();

		ModeSettingDAO modeSettingDAO = ModeSettingDAO.getInstance();
		ModeSettingDTO modeSettingDTO = new ModeSettingDTO();

		modeSettingDTO.setTrIdx(strTrIdx);
		modeSettingDTO.setAmIndex(strAmIndex);
		modeSettingDTO.setAmModeName(strAmModeName);
		modeSettingDTO.setAdDateType(strAdDateType);
		modeSettingDTO.setAdSDateDay(strAdSDateDay);
		modeSettingDTO.setAdEDateDay(strAdEDateDay);
		modeSettingDTO.setAdWeekMon(strAdWeekMon);
		modeSettingDTO.setAdWeekTue(strAdWeekTue);
		modeSettingDTO.setAdWeekWed(strAdWeekWed);
		modeSettingDTO.setAdWeekThu(strAdWeekThu);
		modeSettingDTO.setAdWeekFri(strAdWeekFri);
		modeSettingDTO.setAdWeekSat(strAdWeekSat);
		modeSettingDTO.setAdWeekSun(strAdWeekSun);

		iRtn = modeSettingDAO.insertModeSetting(modeSettingDTO);


		switch(iRtn) {
		    case 1:
				//request.setAttribute("msg", "등록되었습니다.");
				break;
			case 2:
				request.setAttribute("msg", "이미 존재하는 설정입니다.");
				break;
			case -1:
				request.setAttribute("msg", "음성 안내를 추가할 수 없습니다.");
				break;
		}

		return "./voiceGuideSettingListForm.do2";
	}

}
