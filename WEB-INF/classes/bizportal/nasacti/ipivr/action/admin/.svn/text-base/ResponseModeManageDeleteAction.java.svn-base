package bizportal.nasacti.ipivr.action.admin;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import bizportal.nasacti.ipivr.action.CommandAction;
import bizportal.nasacti.ipivr.common.IpivrConfig;
import bizportal.nasacti.ipivr.dao.ResponseModeDAO;
import bizportal.nasacti.ipivr.dao.VoiceDAO;

public class ResponseModeManageDeleteAction implements CommandAction {
	/**
	 * requestProc
	 *
	 * @param request HttpServletRequest
	 * @param response HttpServletResponse
	 * @param ipivrConfig IpivrConfig
	 * @return String
	 * @throws Throwable
	 * @todo Implement this bizportal.nasacti.ipivr.action.CommandAction
	 *   method
	 */
	public String requestProc(HttpServletRequest request,
							  HttpServletResponse response,
							  IpivrConfig ipivrConfig) throws Throwable {

		int iRtn = -1;
		String strMsg = "";
		String[] strDelIndex;
		strDelIndex = request.getParameterValues("delIndex");

		if(strDelIndex != null) {
			for(int i=0; i <strDelIndex.length; i++) {
				String strIndex[] = strDelIndex[i].split(",");  // 0번째 배열: ScCode, 1번째 배열: nwuIdx

				ResponseModeDAO responseModeDAO = ResponseModeDAO.getInstance();
				iRtn = responseModeDAO.deleteResponseMode(strIndex[0]);
				if(iRtn == 1) {
					VoiceDAO voiceDAO = VoiceDAO.getInstance();
					voiceDAO.deleteUsedVoice(strIndex[1]);
				}

				switch(iRtn) {
					case 1:
						//request.setAttribute("msg", "삭제되었습니다.");
						break;
					case 2:
						strMsg += "\"" + responseModeDAO.getResponseMode(strIndex[0]).getScName() + "\"는(은) 응답시관관리에서 사용된 응답모드로 삭제할 수 없습니다.\\n";
						break;
					case -1:
						strMsg += "\"" + responseModeDAO.getResponseMode(strIndex[0]).getScName() + "\"는(은) 삭제되지 않았습니다.\\n";
						break;
				}
				if(strMsg.length() > 0)
					request.setAttribute("msg", strMsg);
			}
		}
		return "./responseModeManageListForm.do2";
	}
}
