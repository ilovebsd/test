package bizportal.nasacti.ipivr.dao;

import java.sql.*;
import java.util.*;
import bizportal.nasacti.ipivr.DBPoolConnector;

public class SystemUpdateDAO extends DBPoolConnector {

	private static SystemUpdateDAO instance = new SystemUpdateDAO();

	public static SystemUpdateDAO getInstance() {
		return instance;
	}

	private SystemUpdateDAO() {
	}

	public int update() throws Exception {
		Connection cn = null;
		PreparedStatement pstmt1 = null;
		PreparedStatement pstmt2 = null;
		ResultSet rs = null;
		StringBuffer sb1 = new StringBuffer();
		StringBuffer sb2 = new StringBuffer();
		int iRtn = -1;
		int iRtnCnt = 0;

		try {
			cn = this.getConnection();

			sb1.append("SELECT COUNT(*) FROM nasa_systemupdate         \n");

			pstmt1 = cn.prepareStatement(sb1.toString());

			rs = pstmt1.executeQuery();
			if(rs.next()) {
				if(rs.getInt(1) == 0) {
					sb2.append("INSERT INTO nasa_systemupdate(su_name, su_check) values('IVR', 'Y')    ");
				} else {
					sb2.append("UPDATE nasa_systemupdate SET su_name = 'IVR', su_check = 'Y'           ");
				}
				pstmt2 = cn.prepareStatement(sb2.toString());

				iRtnCnt = pstmt2.executeUpdate();

				if(iRtnCnt > 0) iRtn = 1;
			}
		} catch(Exception e) {
			e.printStackTrace();
		} finally {
			if(rs != null) try{ rs.close(); } catch(SQLException se) {se.printStackTrace();}
			if(pstmt1 != null) try{ pstmt1.close(); } catch(SQLException se) {se.printStackTrace();}
			if(pstmt2 != null) try{ pstmt2.close(); } catch(SQLException se) {se.printStackTrace();}
			if(cn != null) try{ cn.close(); } catch(SQLException se) {se.printStackTrace();}
		}
		return iRtn;

    }
}
