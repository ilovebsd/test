package bizportal.nasacti.record;

import java.util.*;

import java.sql.*;

import bizportal.nasacti.record.backupConfigBean;


import bizportal.nasacti.ipivr.DBPoolConnector;

public class backupConfigClass extends DBPoolConnector{
	public backupConfigClass(){
	}


	


	public Vector backupConfigSelect(){
		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		Vector vList = new Vector();
		String query = "";
		try{
			con=this.getConnection();
			//String dbName = this.getDBConfig();
			String dbName = "postgre";
			if( dbName.equals("mysql") ){
				query = "Select auto, DVDDrive, backuppath, PreservationType ";
			}else if( dbName.equals("postgre") ){
				query = "Select auto, DVDDrive, backuppath, PreservationType ";
			}else if( dbName.equals("mssql2000") ){
				query = "Select auto, DVDDrive, replace(backuppath, '\\', '/'  ) As backuppath, PreservationType ";
			}else if( dbName.equals("mssql2005") ){
				query = "Select auto, DVDDrive, replace(backuppath, '\\', '/'  ) As backuppath, PreservationType ";
			}else{
				query = "Select auto, DVDDrive, backuppath, PreservationType, bk_shour, bk_smin ";
			}

			query = query + ", PreservationMonth, PreservationCapacity, ServerIP ";
			query = query + ", OriginalTrans, BackupTrans,txt_Backup_Lastday From ncr_backupconfig";
			pstmt = con.prepareStatement(query);
			pstmt.clearParameters();
			rs = pstmt.executeQuery();

			while(rs.next()){
				backupConfigBean backupConfig = new backupConfigBean();
				backupConfig.setAuto( rs.getString("auto"));
				backupConfig.setDvdDrive( rs.getString("DVDDrive"));
				backupConfig.setBackupPath( rs.getString("backuppath"));
				backupConfig.setPreservationType( rs.getString("PreservationType"));
				backupConfig.setPreservationMonth( rs.getString("PreservationMonth"));
				backupConfig.setPreservationCapacity( rs.getString("PreservationCapacity"));
				backupConfig.setServerIp( rs.getString("ServerIP"));
				backupConfig.setOriginaltrans( rs.getString("OriginalTrans"));
				backupConfig.setBackuptrans( rs.getString("BackupTrans"));
				backupConfig.setTxt_Backup_Lastday( rs.getString("txt_Backup_Lastday"));
				//backupConfig.setIntBkShour( rs.getInt("bk_shour"));
				//backupConfig.setIntBkSmin( rs.getInt("bk_smin"));


				vList.add(backupConfig);
			}

		}catch(Exception ex){
			System.out.println("Exception" + ex);
		}finally{
			if(rs != null) try{rs.close(); } catch(SQLException se) { se.printStackTrace();}
			if(pstmt != null) try{ pstmt.close(); } catch(SQLException se) {se.printStackTrace();}
			if(con != null) try{ con.close(); } catch(SQLException se) {se.printStackTrace();}
		}
		return vList;
	}


	public void backupConfigUpdate(backupConfigBean backupConfigBean){
		Connection con = null;
		PreparedStatement pstmt = null;

		try{
			con=this.getConnection();
			String query = "Update ncr_backupconfig Set ";
			//query = query + " Auto = ? , ";
			query = query + " ServerIP = ? , ";
			//query = query + " DVDDrive = ? , ";
			query = query + " backuppath = ? , ";
			query = query + " PreservationType = ? , ";
			query = query + " PreservationMonth = ? , ";
			query = query + " PreservationCapacity = ?, ";
			//query = query + " OriginalTrans = ?, ";
			query = query + " BackupTrans = ?, "; 
			query = query + " txt_Backup_Lastday = ? ";
			//query = query + " bk_shour = ? ,";
			//query = query + " bk_smin = ? ";

			pstmt = con.prepareStatement(query);
			//pstmt.setString(1, backupConfigBean.getAuto() );
			pstmt.setString(1, backupConfigBean.getServerIp() );
			//pstmt.setString(3, backupConfigBean.getDvdDrive() );
			pstmt.setString(2, backupConfigBean.getBackupPath() );
			pstmt.setString(3, backupConfigBean.getPreservationType() );
			pstmt.setString(4, backupConfigBean.getPreservationMonth() );
			pstmt.setString(5, backupConfigBean.getPreservationCapacity() );
			//pstmt.setString(6, backupConfigBean.getOriginaltrans() );
			pstmt.setString(6, backupConfigBean.getBackuptrans() );
			pstmt.setString(7, backupConfigBean.getTxt_Backup_Lastday() );
			//pstmt.setInt(9, backupConfigBean.getIntBkShour() );
			//pstmt.setInt(10, backupConfigBean.getIntBkSmin() );

			pstmt.executeUpdate();
		}catch(Exception ex){
			System.out.println("Exception" + ex);		
		}finally{
			if(pstmt != null) try{ pstmt.close(); } catch(SQLException se) {se.printStackTrace();}
			if(con != null) try{ con.close(); } catch(SQLException se) {se.printStackTrace();}
		}
	}


	public void backupConfigMsgsPathUpdate(backupConfigBean backupBean ){
		Connection con = null;
		PreparedStatement pstmt = null;

		try{
			con=this.getConnection();
			String query = "Update ncr_backupconfig set ";
			query = query + " MsgsPath = ? ";
			
			pstmt = con.prepareStatement(query);
			pstmt.setString(1, backupBean.getMsgsPath() );
			pstmt.executeUpdate();
		}catch(Exception ex){
			System.out.println("Exception" + ex);
		}finally{
			if(pstmt != null) try{ pstmt.close(); } catch(SQLException se) {se.printStackTrace();}
			if(con != null) try{ con.close(); } catch(SQLException se) {se.printStackTrace();}
		}
	}




}