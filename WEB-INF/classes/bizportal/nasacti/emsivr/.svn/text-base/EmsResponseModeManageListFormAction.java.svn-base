package bizportal.nasacti.emsivr;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import bizportal.nasacti.ipivr.action.CommandAction;
import bizportal.nasacti.ipivr.common.IpivrConfig;
import bizportal.nasacti.ipivr.dao.ResponseModeDAO;
import java.util.List;
import java.util.ArrayList;
import bizportal.nasacti.ipivr.dao.VoiceDAO;
import bizportal.nasacti.ipivr.dto.ResponseModeDTO;
import bizportal.nasacti.ipivr.dto.UsedVoiceDTO;
import bizportal.nasacti.ipivr.dto.VoiceDTO;

public class EmsResponseModeManageListFormAction implements CommandAction {
	/**
	 * requestProc
	 *
	 * @param request HttpServletRequest
	 * @param response HttpServletResponse
	 * @param ipivrConfig IpivrConfig
	 * @return String
	 * @throws Throwable
	 * @todo Implement this bizportal.nasacti.ipivr.action.CommandAction
	 *   method
	 */
	public String requestProc(HttpServletRequest request,
							  HttpServletResponse response,
							  IpivrConfig ipivrConfig) throws Throwable {

		ArrayList usedVoiceDTOList = new ArrayList();
		ArrayList voiceDTOList = new ArrayList();

		ResponseModeDAO responseModeDAO = ResponseModeDAO.getInstance();
		List responseModeDTOList = responseModeDAO.getAllResponseMode(ResponseModeDAO.ACTIVE_IVR);

		VoiceDAO voiceDAO = VoiceDAO.getInstance();

		for(int i=0; i < responseModeDTOList.size(); i++) {
			usedVoiceDTOList.add(voiceDAO.getUsedResponseModeVoice(((ResponseModeDTO)responseModeDTOList.get(i)).getScVoiceFile()));

			String strScVoiceFile = ((ResponseModeDTO)responseModeDTOList.get(i)).getScVoiceFile();
			UsedVoiceDTO usedVoiceDTO = null;
			VoiceDTO voiceDTO = null;
			usedVoiceDTO = voiceDAO.getUsedResponseModeVoice(strScVoiceFile);
			String strWIndex = "";
			if(usedVoiceDTO != null) {
				strWIndex = usedVoiceDTO.getWIndex();
				voiceDTO = voiceDAO.getVoice(strWIndex);
			}
			voiceDTOList.add(voiceDTO);
		}

		usedVoiceDTOList.trimToSize();
		voiceDTOList.trimToSize();

		request.setAttribute("usedVoiceDTOList", usedVoiceDTOList);
		request.setAttribute("voiceDTOList", voiceDTOList);
		request.setAttribute("responseModeDTOList", responseModeDTOList);
		return "/ivr/emsResponseModeManageList.jsp";
	}
}
