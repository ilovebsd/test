package command;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import acromate.common.util.WebUtil;
import acromate.ConnectionManager;
import acromate.common.StaticString;
import business.LogHistory;

import com.acromate.driver.db.DataStatement;
import com.acromate.util.Str;
import waf.BaseEntity;
import waf.SessionManager;
import webuser.ServerLogin;
import dto.system.SIPRegServerDTO;
import dto.system.GatewayConfigDTO;
import system.SystemConfigFileMake;
import framework.url.Urldownload;
import dao.system.CommonDAO;
import java.util.ArrayList;
import java.util.HashMap;
import system.SystemInfoList;
import gateway.AutomaticDialingSNMP;

public class SystemFileSave_GatewayCommand implements Command {
	private int nEmergency;
	public String execute(HttpServletRequest req, HttpServletResponse res) {
		String 			forwardingPage 	= "";				
		String 			resStr 			= "";

		try {
			String	fxsTx			= new String(Str.CheckNullString(req.getParameter("hiFxsTx")).getBytes("8859_1"), "euc-kr");
			String	fxsRx			= new String(Str.CheckNullString(req.getParameter("hiFxsRx")).getBytes("8859_1"), "euc-kr");
			String	fxsPort1		= new String(Str.CheckNullString(req.getParameter("hiFxsPort1")).getBytes("8859_1"), "euc-kr");
			String	fxsPort2		= new String(Str.CheckNullString(req.getParameter("hiFxsPort2")).getBytes("8859_1"), "euc-kr");
			String	hookTime1		= new String(Str.CheckNullString(req.getParameter("hiHookTime1")).getBytes("8859_1"), "euc-kr");
			String	hookTime2		= new String(Str.CheckNullString(req.getParameter("hiHookTime2")).getBytes("8859_1"), "euc-kr");
			String	fxoTx			= new String(Str.CheckNullString(req.getParameter("hiFxoTx")).getBytes("8859_1"), "euc-kr");
			String	fxoRx			= new String(Str.CheckNullString(req.getParameter("hiFxoRx")).getBytes("8859_1"), "euc-kr");
			String	fxoPort			= new String(Str.CheckNullString(req.getParameter("hiFxoPort")).getBytes("8859_1"), "euc-kr");
			String	country			= new String(Str.CheckNullString(req.getParameter("hiCountry")).getBytes("8859_1"), "euc-kr");
			String	vad				= new String(Str.CheckNullString(req.getParameter("hiVad")).getBytes("8859_1"), "euc-kr");
			String	cng				= new String(Str.CheckNullString(req.getParameter("hiCng")).getBytes("8859_1"), "euc-kr");
			String	echo			= new String(Str.CheckNullString(req.getParameter("hiEcho")).getBytes("8859_1"), "euc-kr");
			String	dtmf			= new String(Str.CheckNullString(req.getParameter("hiDtmf")).getBytes("8859_1"), "euc-kr");
			String	driverPort1		= new String(Str.CheckNullString(req.getParameter("hiDriverPort1")).getBytes("8859_1"), "euc-kr");
			String	driverPort2		= new String(Str.CheckNullString(req.getParameter("hiDriverPort2")).getBytes("8859_1"), "euc-kr");
			String	digit			= new String(Str.CheckNullString(req.getParameter("hiDigit")).getBytes("8859_1"), "euc-kr");
			String	dialtone		= new String(Str.CheckNullString(req.getParameter("hiDialtone")).getBytes("8859_1"), "euc-kr");
			String	dialPlan		= new String(Str.CheckNullString(req.getParameter("hiDialPlan")).getBytes("8859_1"), "euc-kr");
			String	maxDigit		= new String(Str.CheckNullString(req.getParameter("hiMaxDigit")).getBytes("8859_1"), "euc-kr");
			String	codecName1		= new String(Str.CheckNullString(req.getParameter("hiCodecName1")).getBytes("8859_1"), "euc-kr");
			String	codecPtime1		= new String(Str.CheckNullString(req.getParameter("hiCodecPtime1")).getBytes("8859_1"), "euc-kr");
			String	codecName2		= new String(Str.CheckNullString(req.getParameter("hiCodecName2")).getBytes("8859_1"), "euc-kr");
			String	codecPtime2		= new String(Str.CheckNullString(req.getParameter("hiCodecPtime2")).getBytes("8859_1"), "euc-kr");
			String	codecName3		= new String(Str.CheckNullString(req.getParameter("hiCodecName3")).getBytes("8859_1"), "euc-kr");
			String	codecPtime3		= new String(Str.CheckNullString(req.getParameter("hiCodecPtime3")).getBytes("8859_1"), "euc-kr");
			String	codecName4		= new String(Str.CheckNullString(req.getParameter("hiCodecName4")).getBytes("8859_1"), "euc-kr");
			String	codecPtime4		= new String(Str.CheckNullString(req.getParameter("hiCodecPtime4")).getBytes("8859_1"), "euc-kr");
			String	area_Code		= new String(Str.CheckNullString(req.getParameter("hiArea_Code")).getBytes("8859_1"), "euc-kr");
			String	areaNumber		= new String(Str.CheckNullString(req.getParameter("hiAreaNumber")).getBytes("8859_1"), "euc-kr");
			String	areaException	= new String(Str.CheckNullString(req.getParameter("hiAreaException")).getBytes("8859_1"), "euc-kr");
			
			String 	userID			= new String(req.getParameter("hiUserID").getBytes("8859_1"), "euc-kr");		// 로그인 ID
			
			int 	insertResult= 0;
			
			resStr = "gatewayConfig.jsp";
			
			GatewayConfigDTO dto = new GatewayConfigDTO();
			dto.setFxsTx(fxsTx);
			dto.setFxsRx(fxsRx);
			dto.setFxsPort1(fxsPort1);
			dto.setFxsPort2(fxsPort2);
			dto.setHookTime1(hookTime1);
			dto.setHookTime2(hookTime2);
			dto.setFxoTx(fxoTx);
			dto.setFxoRx(fxoRx);
			dto.setFxoPort(fxoPort);
			dto.setCountry(country);
			dto.setVad(vad);
			dto.setCng(cng);
			dto.setEcho(echo);
			dto.setDtmf(dtmf);
			dto.setDriverPort1(driverPort1);
			dto.setDriverPort2(driverPort2);
			dto.setDigit(digit);
			dto.setDialtone(dialtone);
			dto.setDialPlan(dialPlan);
			dto.setMaxDigit(maxDigit);
			dto.setCodecName1(codecName1);
			dto.setCodecPtime1(codecPtime1);
			dto.setCodecName2(codecName2);
			dto.setCodecPtime2(codecPtime2);
			dto.setCodecName3(codecName3);
			dto.setCodecPtime3(codecPtime3);
			dto.setCodecName4(codecName4);
			dto.setCodecPtime4(codecPtime4);
			dto.setArea_Code(area_Code);
			dto.setAreaNumber(areaNumber);
			dto.setAreaException(areaException);
			
			SystemConfigFileMake makeFile = new SystemConfigFileMake();
			
			insertResult = makeFile.makeFile_Gateway(dto);
			
			if(insertResult==1){
				// ############### LogHistory 처리  ###############
				String		strIp		= req.getRemoteAddr();
				LogHistory	logHistory 	= new LogHistory();
				int int_result = logHistory.LogHistorySave(userID+"|87|환경설정(Gateway Cfg 파일 설정)|1|"+strIp);
				// ##############################################
				
				resStr = "gatewayConfig.jsp";
				res.sendRedirect("/bizportal/newGateway/"+resStr);
			}else{
				res.sendRedirect("/bizportal/errorMessage.jsp");
			}

		} catch (Exception e) {
			try{
				res.sendRedirect("/bizportal/errorMessage.jsp");
			} catch (Exception ee) {
			}
			e.printStackTrace();
		} finally {

		}		
		return forwardingPage;
	}
	
	
}
