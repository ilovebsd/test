package command;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import acromate.common.StaticString;
import acromate.common.util.StringUtil;

import com.acromate.driver.db.DataStatement;
import com.acromate.util.Str;
import business.SmsSend;

public class SmsSendCommand implements Command {
	public String execute(HttpServletRequest req, HttpServletResponse res) {
		String forwardingPage = "";
		String resStr = "";

		try {			
			String 	smsMessage2		= new String(Str.CheckNullString(req.getParameter("smsMessage")).getBytes("8859_1"), "euc-kr");		// 메세지
			String 	smsMessage		= req.getParameter("smsMessage");																	// 메세지
			String 	smsStr			= new String(Str.CheckNullString(req.getParameter("smsStr")).getBytes("8859_1"), "euc-kr");			// 수신 전화번호
			String 	smsSendNo		= new String(Str.CheckNullString(req.getParameter("smsSendNo")).getBytes("8859_1"), "euc-kr");		// 발신 전화번호
			String 	smsDate			= new String(Str.CheckNullString(req.getParameter("smsDate")).getBytes("8859_1"), "euc-kr");		// 예약일자
			String 	smsSendNoCount	= new String(Str.CheckNullString(req.getParameter("smsSendNoCount")).getBytes("8859_1"), "euc-kr");	// 전송할 번호수
			
			//String 	smsMessage2		= req.getParameter("smsMessage");		// 메세지
			//String 	smsMessage3		= new String(Str.CheckNullString(req.getParameter("smsMessage")).getBytes("8859_1"), "utf-8");		// 메세지
			
			System.out.println("############### SMS Message1 : "+smsMessage);
			//System.out.println("############### SMS Message1-2 : "+smsMessage2);
			//System.out.println("############### SMS Message1-3 : "+smsMessage3);
			
			System.out.println("############### SMS 수신 전화번호 : "+smsStr);
			//System.out.println("############### SMS 발신 전화번호 : "+smsSendNo);
			//System.out.println("############### SMS 예약일자 : "+smsDate);
			//System.out.println("############### SMS 전송할 번호수 : "+smsSendNoCount);
			
			resStr = "userAddrList.jsp";

			SmsSend sms = new SmsSend();
			String smsResult = sms.sendSMS(smsMessage, smsStr, smsSendNo, smsDate, smsSendNoCount);

			System.out.println("############### SMS 처리결과 : "+smsResult);
			if(!"".equals(smsResult)){
				// 정상처리
				boolean smsReceiveResult = sms.smsReceiveData(smsMessage2, smsStr, smsSendNo, smsDate, smsSendNoCount, smsResult);
				
				res.sendRedirect("/bizportal/address/"+resStr);
			}else{
				// 장애발생
				res.sendRedirect("/bizportal/address/"+resStr);
			}
			
		} catch (Exception e) {
			try{
				res.sendRedirect("/bizportal/address/"+resStr+"?result=-1");
			} catch (Exception ee) {
			}

			e.printStackTrace();
		} finally {
		}
		return forwardingPage;
	}
}
