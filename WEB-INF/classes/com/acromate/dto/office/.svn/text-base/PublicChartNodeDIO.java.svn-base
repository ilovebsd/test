package com.acromate.dto.office;

import com.acromate.util.Logger;
import com.acromate.util.Str;
import com.acromate.data.DataIO;
import com.acromate.data.ListIO;
import com.acromate.data.code.AppCode;

public class PublicChartNodeDIO extends ListIO {
    private Logger log = Logger.getLogger(this.getClass());

    public static final int CHARTROOT_TYPE = 1;
    public static final int DEPT_TYPE = 2;
    public static final int SUBSCRIBER_TYPE = 3;
    private int    errorcode;
    private int    nodeType ;
    private String nodeName = "";
    private DeptFolderDIO dept = null;
    private SubscriberItemDIO subscriber = null;
    public  Object linker = null;

    public int    getNodeType() { return nodeType ; }
    public void   setNodeType( int nodeType ) { this.nodeType = nodeType ; }

    public String getNodeName() { return nodeName; }
    public void setNodeName(String nodeName) { this.nodeName = nodeName; }

    public DeptFolderDIO    getDeptFolderDIO() { return dept ; }
    public void   setDeptFolderDIO( DeptFolderDIO dept ) { this.dept = dept ; }

    public SubscriberItemDIO    getSubscriberItemDIO() { return subscriber ; }
    public void   setSubscriberItemDIO( SubscriberItemDIO subscriber ) { this.subscriber = subscriber ; }

    public int getIndex(Object obj) {
        return list.indexOf(obj);
    }

    public String getClassID() {
        return nodeName;
    }

    protected int setFieldData(String field, String value) {
        StringBuilder temp = new StringBuilder(field.toLowerCase());
		int errcode = 0;
        if(compareFieldID(temp, "nodeType".toLowerCase()) == true) {
            if(!value.equals("")) nodeType = Str.CheckNullInt(value);
            return 0;
        }
		if(compareFieldID( temp, "nodeName".toLowerCase()) ){
			StringBuilder sbText = new StringBuilder();
			if   ((errcode = setString( sbText, value)) == 0)
				nodeName = sbText.toString();
			return (AppCode.ERR_NOERROR) ;
		}
        if(compareFieldID(temp, "dept".toLowerCase()) == true) {
            if (value.trim().length()==0) return 0;
            if (dept == null) dept = new DeptFolderDIO();
            return dept.setParam(temp.toString(), value);
        }
        if(compareFieldID(temp, "subscriberInfo".toLowerCase()) == true) {
            if (value.trim().length()==0) return 0;
            if (subscriber == null) subscriber = new SubscriberItemDIO();
            return subscriber.setParam(temp.toString(), value);
        }
        int result = super.setFieldData( field,  value);
        if (result == 0 ) return result;
        log.error("PublicChartNodeDIO - Not founded field :" + field);
        return 0;
    }

    protected int getFieldData(String field, Index idx, StringBuilder value) {
        boolean resultVal = false;
        StringBuilder fldAlias;
        if(field != null && !field.equals("")) resultVal = true;
        if(field == null) {
            fldAlias = new StringBuilder(); fldAlias.append("");
        } else {
           fldAlias  = new StringBuilder(); fldAlias.append(field);
        }
        if(compareFieldID(fldAlias, "nodeType", idx, value) == true) {
            errorcode = getInteger(nodeType, value);
            if(resultVal || errorcode < 0) return errorcode;
        }
		if   ( compareFieldID( fldAlias, "nodeName", idx, value ) ){
			errorcode = getString( nodeName, value ,  ! resultVal);
			if   ( resultVal || errorcode < 0)	return errorcode ;
		}
        if(compareFieldID(fldAlias, "dept", idx, value) == true) {
            if (dept != null) errorcode = dept.getParam(fldAlias.toString(), value);
            if(resultVal || errorcode < 0) return errorcode;
        }
        if(compareFieldID(fldAlias, "subscriberInfo", idx, value) == true) {
            if (subscriber != null) errorcode = subscriber.getParam(fldAlias.toString(), value);
            if(resultVal || errorcode < 0) return errorcode;
        }
        return super.getFieldData(field, idx, value);
    }
    protected DataIO newListNode() {
       return new PublicChartNodeDIO();
    }
    public String toXmlString( String strParentDesc, String blank, int level ) {
        StringBuilder xml = new StringBuilder() ;
        if (nodeType == DEPT_TYPE || nodeType == CHARTROOT_TYPE) {
//            if (dept != null) {
            	if(level == 0 ){
            		xml.append ( "<folder>\r\n" ) ;
            	}else{
            		xml.append ( dept.toXmlString(strParentDesc,blank) ) ;
            	}
//            }
            
            int size = this.getCount();
            for ( int i = 0 ; i < size ; i++ ) {
                //String str = ((DeptChartNodeDIO)list.get(i)).toXmlString(dept.getDeptName(),blank);
                String deptID = "";
//                if  (dept != null)
                	deptID = strParentDesc;//String.valueOf(dept.getKeyNumber());
                
                String str = ((PublicChartNodeDIO)this.getNode(i)).toXmlString(deptID,blank,1);
                xml.append( str ) ;
            }
//            if (dept != null)	
            	xml.append ( blank + "</folder>\n" ) ;
//            else	xml.append ( blank + "</folder>\n" ) ;
        }
        else if (nodeType == SUBSCRIBER_TYPE) {
            //xml.append ( subscriberInfo.toXmlString(String.valueOf(dept.getDeptID()),blank) ) ;
            if (subscriber != null) xml.append ( subscriber.toXmlString(strParentDesc,blank) ) ;
        }
        return xml.toString();
    }
    /*public String toXmlString( String strParentDesc, String blank ) {
        StringBuilder xml = new StringBuilder() ;
        if (nodeType == DEPT_TYPE || nodeType == CHARTROOT_TYPE) {
            if (dept != null) {
            	xml.append ( dept.toXmlString(strParentDesc,blank) ) ;
//            	xml.append ( "<folder>\r\n" ) ;
            }
            
            int size = this.getCount();
            for ( int i = 0 ; i < size ; i++ ) {
                //String str = ((DeptChartNodeDIO)list.get(i)).toXmlString(dept.getDeptName(),blank);
                String deptID = "";
                if  (dept != null) {
                	deptID = strParentDesc;//String.valueOf(dept.getKeyNumber());
                }
                String str = ((PublicChartNodeDIO)this.getNode(i)).toXmlString(deptID,blank);
                xml.append( str ) ;
            }
            if (dept != null)	xml.append ( blank + "</folder>\n" ) ;
//            else	xml.append ( blank + "</folder>\n" ) ;
        }
        else if (nodeType == SUBSCRIBER_TYPE) {
            //xml.append ( subscriberInfo.toXmlString(String.valueOf(dept.getDeptID()),blank) ) ;
            if (subscriber != null) xml.append ( subscriber.toXmlString(strParentDesc,blank) ) ;
        }
        return xml.toString();
    }*/
    
}
