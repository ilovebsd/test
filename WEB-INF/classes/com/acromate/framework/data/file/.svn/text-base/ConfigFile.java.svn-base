/*
 * ConfigFile.java
 *
 * Created on 2006년 9월 30일 (토), 오후 12:02
 * Copyright 2006 Acromate, Inc. All rights reserved.
 */

package com.acromate.framework.data.file;

import java.util.Hashtable;
import java.util.Iterator;

/**
 *
 * @author 아크로메이트 기술연구소
 * @version 1.0.0
 */
public class ConfigFile extends TextFile {
    
    private Hashtable<String, Hashtable<String, String>> sections;    
    private Hashtable<String, String> fields;
    
    /**
     * 
     * @param fileName 
     */
    public ConfigFile() {       
        this.sections = new Hashtable<String, Hashtable<String, String>>();
    }
    
    /**
     * Returns config file data
     * @return 
     */
    public Hashtable<String, Hashtable<String, String>> getSections() {
        return sections;
    }
    
    /**
     * Read config file data
     * @return 
     */
    public boolean load(String fileName) {
        if(!super.load(fileName)) {
            return false;
        }
        String   data = "";
        Iterator<?> iter = buffers.iterator();
        while(iter.hasNext()) {
            String lines  = (String)iter.next();
            if(lines.equals("")) continue;
            byte[] bytes = lines.getBytes();

            //If this line data is comment or not
            if((bytes[0] == (byte)';') || (bytes[0] == 0x10) || (bytes[0] == ' ')) {
                continue;
 
            //If this line data is section or not
            } else if(bytes[0] == (byte)'[') {
                int index = lines.indexOf(']');
                String section = lines.substring(1, index).trim();
                fields = new Hashtable<String, String>();
                sections.put(section, fields);
  
            //If this line is data or not
            } else {
                //If this line is concactation delimeter char
                int index = lines.indexOf('\\');
                if(index >= 0) {
                    data += lines.substring(0, index).trim();
                    continue;
                }else data = data + lines.trim();                
                index = data.indexOf('=');
                String field = data.substring(0, index).trim();
                String value = data.substring(index+1, data.length()).trim();
                int comment  = value.indexOf(';');
                if( comment >= 0) {
                    value = value.substring(0, comment);
                } data = "";
                fields.put(field, value);                
            }
        }
        return true;
    }
}
