package com.acromate.dao.element ;

import com.acromate.db.QueryStatement ;
import com.acromate.dto.element.E164DTO;
import java.util.ArrayList;
import com.acromate.util.Str;
import java.sql.ResultSet;
import java.sql.*;
import com.acromate.util.Logger;

public class E164DAO {
    private Logger log = Logger.getLogger(this.getClass());

    private E164DTO e164DTO ;
    QueryStatement statement ;

    public E164DAO() {}

    public E164DAO( QueryStatement statement, E164DTO e164DTO ) {
        this.statement = statement ;
        this.e164DTO = e164DTO ;
    }

    public int getCount(QueryStatement statement, String E164) {
        ResultSet rs = null ;
        int count = 0 ;
        try {
            String queryString = "SELECT count(*) From Table_E164  Where e164 = " + E164 +" ";
            rs = statement.executeQuery(queryString) ;
            if ( rs.next() )  count = rs.getInt(1) ;
        } catch(Exception e) {
            log.error("exception occurred > ", e);
            count = -1 ;
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) { log.error("exception occurred > ", e); }
        }

        return count;
    }

    public boolean isNewE164(QueryStatement statement, String strE164) {
        boolean isNew = true;
        ResultSet rs = null;
        try {
            String queryString = "SELECT * FROM table_e164 WHERE e164='" + strE164 + "'";
            rs = statement.executeQuery(queryString);
            if (rs.next())
                isNew = false;

        } catch(Exception e) {
           log.error("exception occurred > ", e);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) {
                log.error("exception occurred > ", e);
            }
        }
        return isNew;
    }

    public E164DTO getDTO(QueryStatement statement, String strE164 ) {
        E164DTO e164DTO = null;
        ResultSet rs = null;

        try {
            String queryString = "SELECT E164 , AreaCode, IsGroup, GroupID, SubID, LEVELID , ExtensionNumber, PrefixTableID, CallerService, AnswerService,";
            queryString += " CommonService, VirtualCID, DirectForwardNumber,  HotLineNumber, HotLineDelayTime, InStartPosition, InCutDigit, InAddDigit,";
            queryString += " OutStartPosition, OutCutDigit, OutAddDigit, LastReceivedNumber, LastDialedNumber, MailBox, ChargeType, ChargeNumber, ChargeServer,";
            queryString += " EndpointRelationType, StartFlag, OpenDate, OpenReservedDate, CloseReservedDate, DeleteReservedDate";
            queryString += " From Table_E164 ";
            queryString += " WHERE E164 = '" + strE164 + "' ";

            log.info(queryString) ;
            rs = statement.executeQuery(queryString) ;

            if ( rs.next() )  {
                e164DTO = new E164DTO() ;
                e164DTO.setE164(Str.CheckNullString(rs.getString(1)));
                e164DTO.setAreaCode(Str.CheckNullString(rs.getString(2)));
                e164DTO.setIsGroup(rs.getInt(3));
                e164DTO.setGroupID(Str.CheckNullString(rs.getString(4)));
                e164DTO.setSubID(Str.CheckNullString(rs.getString(5)));
                e164DTO.setLevelID(Str.CheckNullString(rs.getString(6)));
                e164DTO.setExtensionNumber(Str.CheckNullString(rs.getString(7)));
                e164DTO.setPrefixTableID(Str.CheckNullString(rs.getString(8)));
                e164DTO.setCallerService(Str.CheckNullString(rs.getString(9)));
                e164DTO.setAnswerService(Str.CheckNullString(rs.getString(10)));
                e164DTO.setCommonService(Str.CheckNullString(rs.getString(11)));
                e164DTO.setVirtualCID(Str.CheckNullString(rs.getString(12)));
                e164DTO.setDirectForwardNumber(Str.CheckNullString(rs.getString(13)));
                e164DTO.setHotLineNumber(Str.CheckNullString(rs.getString(14)));
                e164DTO.setHotLineDelayTime(rs.getInt(15));
                e164DTO.setInStartPosition(rs.getInt(16));
                e164DTO.setInCutDigit(rs.getInt(17));
                e164DTO.setInAddDigit(Str.CheckNullString(rs.getString(18)));
                e164DTO.setOutStartPosition(rs.getInt(19));
                e164DTO.setOutCutDigit(rs.getInt(20));
                e164DTO.setOutAddDigit(Str.CheckNullString(rs.getString(21)));
                e164DTO.setLastReceivedNumber(Str.CheckNullString(rs.getString(22)));
                e164DTO.setLastDialedNumber(Str.CheckNullString(rs.getString(23)));
                e164DTO.setMailBox(Str.CheckNullString(rs.getString(24)));
                e164DTO.setChargeType(rs.getInt(25));
                e164DTO.setChargeNumber(Str.CheckNullString(rs.getString(26)));
                e164DTO.setChargeServer(Str.CheckNullString(rs.getString(27)));
                e164DTO.setEndpointRelationType(rs.getInt(28));
                e164DTO.setStartFlag(rs.getInt(29));
                e164DTO.setOpenDate(Str.CheckNullString(rs.getString(30)));
                e164DTO.setOpenReservedDate(Str.CheckNullString(rs.getString(31)));
                e164DTO.setCloseReservedDate(Str.CheckNullString(rs.getString(32)));
                e164DTO.setDeleteReservedDate(Str.CheckNullString(rs.getString(33)));
            }
        } catch(Exception e) {
            log.error("exception occurred > ", e);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) { log.error("exception occurred > ", e); }
        }
        return e164DTO;
    }


    public ArrayList getList(QueryStatement statement, int OrgChartID) {
        ArrayList list = new ArrayList() ;
        E164DTO e164DTO = null ;
        ResultSet rs = null ;

        try {
            String queryString = "SELECT  E164ID, OrgChartID, ParentID, E164Name, Description, Type, UsePickup, KeyNumber, Officebox, Operation " ;
            queryString += " From Table_E164 Where OrgChartID = " + OrgChartID +" ";
            rs = statement.executeQuery(queryString) ;
            log.info(queryString) ;
/*
            while ( rs.next() )  {
                e164DTO = new E164DTO() ;
                e164DTO.setE164ID(rs.getInt(1));
                e164DTO.setOrgChartID(rs.getInt(2));
                e164DTO.setParentID(rs.getInt(3));
                e164DTO.setE164Name(Str.CheckNullString(rs.getString(4)));
                e164DTO.setDescription(Str.CheckNullString(rs.getString(5)));
                e164DTO.setType(rs.getInt(6));
                e164DTO.setUsePickup(rs.getInt(7));
                e164DTO.setKeyNumber(Str.CheckNullString(rs.getString(8)));
                e164DTO.setOfficebox(Str.CheckNullString(rs.getString(9)));
                e164DTO.setOperation(rs.getInt(10));
                list.add(e164DTO) ;
            }*/
        } catch(Exception e) {
            log.error("exception occurred > ", e);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) { log.error("exception occurred > ", e); }
        }

        return list;
    }

    public boolean insert ( QueryStatement statement, E164DTO e164DTO  ) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) return false;

            queryString =   " INSERT INTO Table_E164 ";
            queryString += " (E164, AreaCode, IsGroup, GroupID, SubID, ExtensionNumber, PrefixTableID, ";
            queryString += " CallerService, AnswerService, CommonService, VirtualCID, DirectForwardNumber, HotLineNumber, HotLineDelayTime, ";
            queryString += " InStartPosition, InCutDigit, InAddDigit, OutStartPosition, OutCutDigit, OutAddDigit, LastReceivedNumber, LastDialedNumber, ";
            queryString += " MailBox, ChargeType, ChargeNumber, EndpointRelationType, StartFlag, OpenDate, OpenReservedDate, CloseReservedDate, ";
            queryString += " DeleteReservedDate, LEVELID ) " ;
            queryString += " VALUES (" ;
            queryString += " '" + e164DTO.getE164() + "'," ;
            queryString += " '" + e164DTO.getAreaCode() + "'," ;
            queryString += "  " + e164DTO.getIsGroup() + " ," ;
            queryString += " '" + e164DTO.getGroupID() + "'," ;
            queryString += " '" + e164DTO.getSubID() + "'," ;
            queryString += " '" + e164DTO.getExtensionNumber() + "'," ;
            queryString += " '" + e164DTO.getPrefixTableID() + "'," ;
            queryString += " '" + e164DTO.getCallerService() + "'," ;
            queryString += " '" + e164DTO.getAnswerService() + "'," ;
            queryString += " '" + e164DTO.getCommonService() + "'," ;
            queryString += " '" + e164DTO.getVirtualCID() + "'," ;
            queryString += " '" + e164DTO.getDirectForwardNumber() + "'," ;
            queryString += " '" + e164DTO.getHotLineNumber() + "'," ;
            queryString += "  " + e164DTO.getHotLineDelayTime() + " ," ;
            queryString += "  " + e164DTO.getInStartPosition() + " ," ;
            queryString += "  " + e164DTO.getInCutDigit() + " ," ;
            queryString += " '" + e164DTO.getInAddDigit() + "'," ;
            queryString += "  " + e164DTO.getOutStartPosition() + " ," ;
            queryString += "  " + e164DTO.getOutCutDigit() + " ," ;
            queryString += " '" + e164DTO.getOutAddDigit() + "'," ;
            queryString += " '" + e164DTO.getLastReceivedNumber() + "'," ;
            queryString += " '" + e164DTO.getLastDialedNumber() + "'," ;
            queryString += " '" + e164DTO.getMailBox() + "'," ;
            queryString += "  " + e164DTO.getChargeType() + " ," ;
            queryString += " '" + e164DTO.getChargeNumber() + "'," ;
            queryString += "  " + e164DTO.getEndpointRelationType() + " ," ;
            queryString += "  " + e164DTO.getStartFlag() + " ," ;
            queryString += " TO_DATE('" + e164DTO.getOpenDate() + "','YYYYMMDDHH24MISS')," ;
            queryString += " TO_DATE('" + e164DTO.getOpenReservedDate() + "','YYYYMMDDHH24MISS')," ;
            queryString += " TO_DATE('" + e164DTO.getCloseReservedDate() + "','YYYYMMDDHH24MISS')," ;
            queryString += " TO_DATE('" + e164DTO.getDeleteReservedDate() + "','YYYYMMDDHH24MISS'), " ;
            queryString += " '" + e164DTO.getLevelID() + "')" ;

            log.info(queryString) ;
            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }

    public boolean update( QueryStatement statement, E164DTO e164DTO  ) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) {
                return false;
            }

            queryString = " UPDATE Table_E164 SET ";
            queryString += "AreaCode = '" + e164DTO.getAreaCode() + "'," ;
            queryString += "IsGroup=" + e164DTO.getIsGroup() + " ," ;
            queryString += "GroupID= '" + e164DTO.getGroupID() + "'," ;
            queryString += "SubID= '" + e164DTO.getSubID() + "'," ;
            queryString += "ExtensionNumber= '" + e164DTO.getExtensionNumber() + "'," ;
            queryString += "ExtensionGroupNum= '" + e164DTO.getExtensionGroupNum() + "'," ;
            queryString += "PrefixTableID= '" + e164DTO.getPrefixTableID() + "'," ;
            queryString += "CustomerID = '" + e164DTO.getCustomerID() + "'," ;
            queryString += "CallerService= '" + e164DTO.getCallerService() + "'," ;
            queryString += "AnswerService= '" + e164DTO.getAnswerService() + "'," ;
            queryString += "CommonService= '" + e164DTO.getCommonService() + "'," ;
            queryString += "VirtualCID = '" + e164DTO.getVirtualCID() + "'," ;
            queryString += "DirectForwardNumber= '" + e164DTO.getDirectForwardNumber() + "'," ;
            queryString += "HotLineNumber= '" + e164DTO.getHotLineNumber() + "'," ;
            queryString += "HotLineDelayTime =" + e164DTO.getHotLineDelayTime() + " ," ;
            queryString += "InStartPosition=" + e164DTO.getInStartPosition() + " ," ;
            queryString += "InCutDigit =" + e164DTO.getInCutDigit() + " ," ;
            queryString += "InAddDigit = '" + e164DTO.getInAddDigit() + "'," ;
            queryString += "OutStartPosition =" + e164DTO.getOutStartPosition() + " ," ;
            queryString += "OutCutDigit=" + e164DTO.getOutCutDigit() + " ," ;
            queryString += "OutAddDigit= '" + e164DTO.getOutAddDigit() + "'," ;
            queryString += "LastReceivedNumber = '" + e164DTO.getLastReceivedNumber() + "'," ;
            queryString += "LastDialedNumber = '" + e164DTO.getLastDialedNumber() + "'," ;
            queryString += "MailBox= '" + e164DTO.getMailBox() + "'," ;
            queryString += "ChargeType =" + e164DTO.getChargeType() + " ," ;
            queryString += "ChargeNumber = '" + e164DTO.getChargeNumber() + "'," ;
            queryString += "EndpointRelationType =" + e164DTO.getEndpointRelationType() + " ," ;
            queryString += "StartFlag=" + e164DTO.getStartFlag() + " ," ;
            queryString += "OpenDate = TO_DATE('" + e164DTO.getOpenDate() + "','YYYYMMDDHH24MISS')," ;
            queryString += "OpenReservedDate = TO_DATE('" + e164DTO.getOpenReservedDate() + "','YYYYMMDDHH24MISS')," ;
            queryString += "CloseReservedDate= TO_DATE('" + e164DTO.getCloseReservedDate() + "','YYYYMMDDHH24MISS')," ;
            queryString += "DeleteReservedDate = TO_DATE('" + e164DTO.getDeleteReservedDate() + "','YYYYMMDDHH24MISS') " ;
            queryString += " WHERE E164 = '" + e164DTO.getE164() + "' ";


            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }

    public String getValue(QueryStatement statement, String e164, String fieldName) {
        String value = "";
        if (statement == null)
            return value;

        String strQuery = "SELECT " + fieldName + " FROM Table_E164 WHERE E164 = '"+ e164 + "'" ;
        ResultSet rs = statement.executeQuery(strQuery);
        try {
            if (rs.next())
                value = Str.CheckNullString(rs.getString(1));
            rs.close();
        } catch (SQLException ex) {
           log.error("exception occurred > ", ex);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) {
                log.error("exception occurred > ", e);
            }
        }
        return value;
    }

    public boolean updateValue( QueryStatement statement, String strE164, String fieldName, String value  ) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) {
                return false;
            }
            queryString  = " UPDATE Table_E164 ";
            queryString += " SET " + fieldName + " = '" + value + "' " ;
            queryString += " WHERE E164 = '" + strE164 + "' ";
            log.info(queryString) ;
            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }

    public boolean delete( QueryStatement statement,  E164DTO e164DTO) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) {
                return false;
            }
            queryString = " DELETE FROM Table_E164 Where E164 = '" + e164DTO.getE164() + "' " ;
            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }
}


