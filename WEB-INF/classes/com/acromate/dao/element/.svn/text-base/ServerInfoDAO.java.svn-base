package com.acromate.dao.element;

/**
 * <p>Title: </p>
 *
 * <p>Description: </p>
 *
 * <p>Copyright: Copyright (c) 2007</p>
 *
 * <p>Company: </p>
 *
 * @author not attributable
 * @version 1.0
 */
import com.acromate.dataio.noms.ServerInfoDIO;
import com.acromate.db.QueryStatement ;
import com.acromate.driver.db.DataStatement;

import java.util.ArrayList;
import com.acromate.util.Str;
import java.sql.ResultSet;
//import org.apache.log4j.Logger;

import acromate.ConnectionManager;

public class ServerInfoDAO {
//    private Logger log = Logger.getLogger(this.getClass());

    private ServerInfoDIO serverInfoDIO ;
    QueryStatement statement ;

    public ServerInfoDAO() {}

    public ArrayList getServerInfoList(DataStatement statement, String serverId, int Protocol) {
        ArrayList list = new ArrayList() ;
        ResultSet rs = null ;
        int serviceStatus = 0;
        
        String strWhere = " where 1 = 1 and proxy.endpointid = routestate.endpointid and routestate.protocol = 2 and proxy.endpointclass = 36 ";

        //------Search Condition Check -----------------------------------
        if (serverId != null && !"".equals(serverId))
             strWhere += " AND proxy.endpointid LIKE '%"+serverId+"%' ";


        try {
        	String queryString = "SELECT proxy.EndpointID, proxy.SignalAddress, proxy.SignalPort, routestate.StateFlag, routestate.ServiceFlag "
                +  " FROM table_NeighborProxy proxy, table_RouteState routestate  "
                +	strWhere + " order by proxy.EndpointID ASC " ;
        	System.out.println(queryString);
            rs = statement.executeQuery(queryString) ;
//            log.info(queryString) ;
            while ( rs.next() )  {
                serverInfoDIO = new ServerInfoDIO();
            	System.out.println(Str.CheckNullString(rs.getString("ENDPOINTID")));
            	serverInfoDIO.setServerId(Str.CheckNullString(rs.getString("ENDPOINTID")));
            	serverInfoDIO.setServerName(Str.CheckNullString(rs.getString("ENDPOINTID")));
            	serverInfoDIO.setServerIp(Str.CheckNullString(rs.getString("SignalAddress")));
            	serverInfoDIO.setPortId(Str.CheckNullString(rs.getString("SignalPort")));
            	serverInfoDIO.setAdminStatus(rs.getInt("ServiceFlag")+1);//1:서비스  -> 2:Unblock , 2:미서비스 -> 3:Block
            	serviceStatus = rs.getInt("StateFlag");
            	if (serviceStatus == 1) serverInfoDIO.setServiceStatus("Up");
            	else if (serviceStatus == 2) serverInfoDIO.setServiceStatus("Down");
                list.add(serverInfoDIO) ;
            }
        } catch(Exception e) {
        	e.printStackTrace();
//            log.error("exception occurred > ", e);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) { 
            	e.printStackTrace();
//            	log.error("exception occurred > ", e);
        	}
        }
        return list;
    }

    public ArrayList getOtherInfoList(DataStatement statement) {
        ArrayList list = new ArrayList() ;
        ResultSet rs = null ;
        int serviceStatus = 0;
        serverInfoDIO = new ServerInfoDIO();
        
        String strWhere = " where 1 = 1 and proxy.endpointid = routestate.endpointid and routestate.protocol = 2 and proxy.endpointclass = 40 ";
        try {
        	String queryString = "SELECT proxy.EndpointID, proxy.SignalAddress, proxy.SignalPort, routestate.StateFlag, routestate.ServiceFlag "
                +  " FROM table_NeighborProxy proxy, table_RouteState routestate  "
                +	strWhere + " order by proxy.EndpointID ASC " ;
        	System.out.println(queryString);
            rs = statement.executeQuery(queryString) ;
//            log.info(queryString) ;
            while ( rs.next() )  {
                serverInfoDIO = new ServerInfoDIO();
            	System.out.println(Str.CheckNullString(rs.getString("ENDPOINTID")));
            	serverInfoDIO.setServerId(Str.CheckNullString(rs.getString("ENDPOINTID")));
            	serverInfoDIO.setServerName(Str.CheckNullString(rs.getString("ENDPOINTID")));
            	serverInfoDIO.setServerIp(Str.CheckNullString(rs.getString("SignalAddress")));
            	serverInfoDIO.setPortId(Str.CheckNullString(rs.getString("SignalPort")));
            	serverInfoDIO.setAdminStatus(rs.getInt("ServiceFlag")+1);//1:서비스  -> 2:Unblock , 2:미서비스 -> 3:Block
            	serviceStatus = rs.getInt("StateFlag");
            	if (serviceStatus == 1) serverInfoDIO.setServiceStatus("Up");
            	else if (serviceStatus == 2) serverInfoDIO.setServiceStatus("Down");
                list.add(serverInfoDIO) ;
            }
        } catch(Exception e) {
        	e.printStackTrace();
//            log.error("exception occurred > ", e);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) { 
            	e.printStackTrace();
//            	log.error("exception occurred > ", e);
        	}
        }
        return list;
    }
}


