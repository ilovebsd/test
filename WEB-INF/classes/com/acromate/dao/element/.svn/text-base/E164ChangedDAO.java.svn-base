package com.acromate.dao.element;

import com.acromate.db.QueryStatement ;
import java.util.ArrayList;
import com.acromate.util.Str;
import java.sql.ResultSet;
import com.acromate.dto.element.E164ChangedDTO;
import com.acromate.util.Logger;

public class E164ChangedDAO {
    private Logger log = Logger.getLogger(this.getClass());

    private E164ChangedDTO e164ChangedDTO ;
    QueryStatement statement ;

    public E164ChangedDAO() {}

    public E164ChangedDAO( QueryStatement statement, E164ChangedDTO e164ChangedDTO ) {
        this.statement = statement ;
        this.e164ChangedDTO = e164ChangedDTO ;
    }

    public ArrayList getList(QueryStatement statement, String E164, int ServiceNo) {
        ArrayList list = new ArrayList() ;
        E164ChangedDTO e164ChangedDTO = null ;
        ResultSet rs = null ;

        try {
            String queryString = "SELECT e164, newE164, changedTime, endTime " ;
            queryString += " From Table_E164Changed Where e164 = '" + E164 + "' ";

            rs = statement.executeQuery(queryString) ;
            log.info(queryString) ;
/*
            while ( rs.next() )  {
                e164ChangedDTO = new E164ChangedDTO() ;
                e164ChangedDTO.setE164(Str.CheckNullString(rs.getString(1));
                e164ChangedDTO.setNewE164(rs.getInt(2));
                e164ChangedDTO.setChangedTime(rs.getInt(3));
                e164ChangedDTO.setEndTime(Str.CheckNullString(rs.getString(4));
                list.add(e164ChangedDTO) ;
            }*/
        } catch(Exception e) {
            log.error("exception occurred > ", e);
        } finally {
            try {
                if (rs != null) rs.close();
            } catch(Exception e) { log.error("exception occurred > ", e); }
        }

        return list;
    }


    public E164ChangedDTO getDTO(QueryStatement statement, String E164 ) {
        E164ChangedDTO e164ChangedDTO = null ;
        ResultSet rs = null ;

        try {
            String queryString = "SELECT e164, newE164, TO_CHAR(changedTime,'YYYYMMDD' ), DATEDIFF(ChangedTime, EndTime, 'MONTH')  " ;
            queryString += " From Table_E164Changed Where e164 = '" + E164 + "' ";

            rs = statement.executeQuery(queryString) ;
            System.out.println(queryString) ;

            if ( rs.next() )  {
                e164ChangedDTO = new E164ChangedDTO() ;
                e164ChangedDTO.setE164(Str.CheckNullString(rs.getString(1)));
                e164ChangedDTO.setNewE164(Str.CheckNullString(rs.getString(2)).trim());
                e164ChangedDTO.setChangedTime(Str.CheckNullString( rs.getString(3)));
                e164ChangedDTO.setPeriod(Str.CheckNullString(rs.getString(4)));
            }
        } catch(Exception e) {
            e.printStackTrace() ;
        } finally {
            try {
                if (rs != null) rs.close() ;
            } catch(Exception e) { e.printStackTrace() ; }
        }

        return e164ChangedDTO ;
    }

    public boolean insert ( QueryStatement statement, E164ChangedDTO e164ChangedDTO  ) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) {
                return false;
            }

            queryString =   " INSERT INTO Table_E164Changed ";
            queryString += " (e164, newE164, changedTime, endTime, options)";
            queryString += " VALUES (" ;
            queryString += " '" + e164ChangedDTO.getE164() + "' ," ;
            queryString += " '" + e164ChangedDTO.getNewE164() + "'," ;
            queryString += " TO_DATE('" + e164ChangedDTO.getChangedTime() + "','YYYYMMDD')," ;
            queryString += " DATEADD(TO_DATE('"+e164ChangedDTO.getChangedTime()+"','YYYYMMDD'), "+e164ChangedDTO.getPeriod()+" , 'MONTH')," ;
            queryString += "  " + e164ChangedDTO.getOptions() + " )" ;

            log.info(queryString) ;
            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }


    public boolean update( QueryStatement statement, E164ChangedDTO e164ChangedDTO  ) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) {
                return false;
            }

            queryString = " UPDATE Table_E164Changed SET ";
            queryString += "newE164 = '" + e164ChangedDTO.getNewE164() + "'," ;
            queryString += "changedTime =  TO_DATE('" + e164ChangedDTO.getChangedTime() + "','YYYYMMDD'), ";
            queryString += "endTime =  DATEADD(TO_DATE('"+e164ChangedDTO.getChangedTime()+"','YYYYMMDD'), "+e164ChangedDTO.getPeriod()+" , 'MONTH') " ;
            queryString += " Where e164 = '" + e164ChangedDTO.getE164() + "' ";


            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }

    public boolean delete( QueryStatement statement,  String strE164) {
        String queryString = "";
        int count = 0;
        try {
            if (statement == null) {
                return false;
            }
            queryString = " DELETE FROM Table_E164Changed Where e164 = '" + strE164 + "' ";
            log.info(queryString) ;
            count = statement.executeUpdate(queryString);
        } catch (Exception e) {
            log.error("exception occurred > ", e);
            return false;
        }
        return true ;
    }
}


